{"version":3,"file":"toggle-live-audio-video-CaRbI8OQ.js","sources":["../../static/showcases/toggle-live-audio-video.html?html-proxy&index=0.js","../../static/showcases/toggle-live-audio-video.html?html-proxy&index=1.js"],"sourcesContent":["\n      // Import the pillarbox library\n      import pillarbox from '@srgssr/pillarbox-web';\n\n      // List of channels with audio and video streams\n      const urns = {\n        'srf1': [\n          'urn:srf:audio:69e8ac16-4327-4af4-b873-fd5cd6e895a7',\n          'urn:srf:video:5b90d1fb-477b-4d98-86a6-82921a4bb0ea'\n        ],\n        'srf3': [\n          'urn:srf:audio:dd0fa1ba-4ff6-4e1a-ab74-d7e49057d96f',\n          'urn:srf:video:972b2dbd-3958-43b7-8c15-e92f56c8d734'\n        ],\n        'srfMusikwelle': [\n          'urn:srf:audio:a9c5c070-8899-46c7-ac27-f04f1be902fd',\n          'urn:srf:video:973440d3-60a5-4ddf-ae83-2c77815a32a1'\n        ],\n        'srfVirus': [\n          'urn:srf:audio:66815fe2-9008-4853-80a5-f9caaffdf3a9',\n          'urn:srf:video:2a60b590-8a28-4540-bce8-fc4e52b3b5d8'\n        ],\n        'couleur3': [\n          'urn:rts:audio:3262363',\n          'urn:rts:video:8841634'\n        ]\n      }\n\n      // Create a pillarbox player instance with the thumbnail-preview component\n      window.player = pillarbox('video-element-id');\n      // Change default player volume\n      player.volume(0.3);\n      // Sets autoplay to true after the first user interaction\n      player.one('play', () => { player.autoplay(true) });\n      // Load the source for the player\n      player.src({\n        src: 'urn:srf:audio:69e8ac16-4327-4af4-b873-fd5cd6e895a7', type: 'srgssr/urn'\n      });\n\n      // Listen for click events\n      streams.addEventListener('click', (e) => {\n        e.preventDefault();\n        const { id, nodeName } = e.target;\n\n        if (nodeName !== 'BUTTON') return;\n\n        pillarbox.dom.$$('#streams button').forEach(button => {\n          button.classList.toggle('channel-active', button.id === id);\n          button.querySelector('.material-symbols-outlined').innerText = '';\n        });\n\n        let activeChannelIconEl = pillarbox.dom.$('.channel-active .material-symbols-outlined');\n\n        // When the URN is a different channel we simply load the first stream of the channel\n        if (!urns[id].includes(player.currentSource().mediaData.urn)) {\n          player.src({\n            src: urns[id][0],\n            type: 'srgssr/urn'\n          });\n\n          // Add audio icon since the first stream is a live audio\n          activeChannelIconEl.innerText = 'music_note';\n\n          return;\n        }\n\n        // ---------------------------------------------------------------------\n        // The core logic to switch between the audio and video live stream ----\n        // ---------------------------------------------------------------------\n\n        // Switch between the audio or video stream of the same channel\n        const urn = player.currentSource().mediaData.urn === urns[id][0] ? urns[id][1] : urns[id][0];\n        // Store player's current position before switching URN\n        const currentTime = player.currentTime();\n\n        // Using loadeddata instead of loadedmetadata because of\n        // https://bugs.webkit.org/show_bug.cgi?id=261512\n        player.one('loadeddata', () => {\n          // restore the position\n          player.currentTime(currentTime);\n        });\n\n        // Toggle between the audio and video streams of the same channel\n        player.src({\n          src: urn,\n          type: 'srgssr/urn'\n        });\n\n        // Toggle between the audio and video icon\n        activeChannelIconEl.innerText = urn.includes('audio') ? 'music_note' : 'movie';\n      });\n\n      // Display stream's current time if the manifest contains\n      // #EXT-X-PROGRAM-DATE-TIME\n      function streamTimePosition(player) {\n        const activeCueValue = Array.from(player.textTracks())?.find(t => t.kind === 'metadata')?.activeCues?.[0]?.value;\n\n        if (!activeCueValue) return;\n\n        const { start, programDateTime } = activeCueValue;\n\n        if (!programDateTime) return;\n\n        const offsetInChunk = player.currentTime() - start;\n        const timePosition = new Date(programDateTime + Math.round(offsetInChunk * 1000));\n        const timeToFormat = timePosition.getHours() * 3600 + timePosition.getMinutes() * 60 + timePosition.getSeconds()\n\n        return pillarbox.time.formatTime(timeToFormat, 6000);\n      }\n\n      player.on('timeupdate', () => {\n        const position = streamTimePosition(player);\n\n        if (!position) return streamtime.textContent = \"\";\n\n        streamtime.textContent = position;\n      });\n    ","\n      import pillarbox from '@srgssr/pillarbox-web';\n      import '../../src/layout/header/core-demo-header-component.js';\n\n      document.querySelector('#close-btn').addEventListener('click', () => {\n        window.close();\n      });\n\n      window.pillarbox = pillarbox;\n    "],"names":["urns","pillarbox","e","id","nodeName","button","activeChannelIconEl","urn","currentTime","streamTimePosition","player","activeCueValue","t","start","programDateTime","offsetInChunk","timePosition","timeToFormat","position"],"mappings":"6DAKM,MAAMA,EAAO,CACX,KAAQ,CACN,qDACA,oDACV,EACQ,KAAQ,CACN,qDACA,oDACV,EACQ,cAAiB,CACf,qDACA,oDACV,EACQ,SAAY,CACV,qDACA,oDACV,EACQ,SAAY,CACV,wBACA,uBACV,CACA,EAGM,OAAO,OAASC,EAAU,kBAAkB,EAE5C,OAAO,OAAO,EAAG,EAEjB,OAAO,IAAI,OAAQ,IAAM,CAAE,OAAO,SAAS,EAAI,CAAE,CAAC,EAElD,OAAO,IAAI,CACT,IAAK,qDAAsD,KAAM,YACzE,CAAO,EAGD,QAAQ,iBAAiB,QAAUC,GAAM,CACvCA,EAAE,eAAc,EAChB,KAAM,CAAE,GAAAC,EAAI,SAAAC,CAAQ,EAAKF,EAAE,OAE3B,GAAIE,IAAa,SAAU,OAE3BH,EAAU,IAAI,GAAG,iBAAiB,EAAE,QAAQI,GAAU,CACpDA,EAAO,UAAU,OAAO,iBAAkBA,EAAO,KAAOF,CAAE,EAC1DE,EAAO,cAAc,4BAA4B,EAAE,UAAY,EACjE,CAAC,EAED,IAAIC,EAAsBL,EAAU,IAAI,EAAE,4CAA4C,EAGtF,GAAI,CAACD,EAAKG,CAAE,EAAE,SAAS,OAAO,cAAa,EAAG,UAAU,GAAG,EAAG,CAC5D,OAAO,IAAI,CACT,IAAKH,EAAKG,CAAE,EAAE,CAAC,EACf,KAAM,YAClB,CAAW,EAGDG,EAAoB,UAAY,aAEhC,MACF,CAOA,MAAMC,EAAM,OAAO,cAAa,EAAG,UAAU,MAAQP,EAAKG,CAAE,EAAE,CAAC,EAAIH,EAAKG,CAAE,EAAE,CAAC,EAAIH,EAAKG,CAAE,EAAE,CAAC,EAErFK,EAAc,OAAO,YAAW,EAItC,OAAO,IAAI,aAAc,IAAM,CAE7B,OAAO,YAAYA,CAAW,CAChC,CAAC,EAGD,OAAO,IAAI,CACT,IAAKD,EACL,KAAM,YAChB,CAAS,EAGDD,EAAoB,UAAYC,EAAI,SAAS,OAAO,EAAI,aAAe,OACzE,CAAC,EAID,SAASE,EAAmBC,EAAQ,CAClC,MAAMC,EAAiB,MAAM,KAAKD,EAAO,WAAU,CAAE,GAAG,KAAKE,GAAKA,EAAE,OAAS,UAAU,GAAG,aAAa,CAAC,GAAG,MAE3G,GAAI,CAACD,EAAgB,OAErB,KAAM,CAAE,MAAAE,EAAO,gBAAAC,CAAe,EAAKH,EAEnC,GAAI,CAACG,EAAiB,OAEtB,MAAMC,EAAgBL,EAAO,YAAW,EAAKG,EACvCG,EAAe,IAAI,KAAKF,EAAkB,KAAK,MAAMC,EAAgB,GAAI,CAAC,EAC1EE,EAAeD,EAAa,WAAa,KAAOA,EAAa,WAAU,EAAK,GAAKA,EAAa,WAAU,EAE9G,OAAOf,EAAU,KAAK,WAAWgB,EAAc,GAAI,CACrD,CAEA,OAAO,GAAG,aAAc,IAAM,CAC5B,MAAMC,EAAWT,EAAmB,MAAM,EAE1C,GAAI,CAACS,EAAU,OAAO,WAAW,YAAc,GAE/C,WAAW,YAAcA,CAC3B,CAAC,EChHD,SAAS,cAAc,YAAY,EAAE,iBAAiB,QAAS,IAAM,CACnE,OAAO,MAAK,CACd,CAAC,EAED,OAAO,UAAYjB"}