{"version":3,"file":"chapter-selection-CRbfJ_pg.js","sources":["../../static/showcases/chapter-selection.html?html-proxy&index=0.js","../../static/showcases/chapter-selection.html?html-proxy&index=1.js"],"sourcesContent":["\n  // Import the pillarbox library\n  import pillarbox from '@srgssr/pillarbox-web';\n\n  // Create a pillarbox player instance with the currentChapter plugin\n  window.player = pillarbox(\n    'video-element-id',\n    { muted: true }\n  );\n\n  // Listen for a chapter change\n  player.on('srgssr/chapter', ({ data = { text : null} }) => {\n    const currentChapter = JSON.parse(data.text);\n\n    // Select the current chapter\n    document.querySelectorAll('.chapter').forEach(chapter => {\n      const isChapterSelected = currentChapter && currentChapter.urn === chapter.dataset.urn;\n      chapter.classList.toggle('chapter-selected', isChapterSelected);\n    });\n  });\n\n  // Listens for the loadeddata event to build the chapter selector\n  player.on('loadeddata', () => {\n    // Remove the chapter selector element each time a new media is loaded\n    if(document.getElementById('chapter-selector')){\n      document.getElementById('chapter-selector').remove();\n    }\n\n    // Get each cue from the srgssr-chapters text track\n    const chapters = Array.from(player.textTracks().getTrackById('srgssr-chapters').cues);\n\n    if(!chapters) return;\n\n    // Create the chapter selector element\n    const chapterSelector = document.createElement('div');\n\n    chapterSelector.id =\"chapter-selector\";\n\n    // Create the chapter element\n    chapters.forEach(({startTime, text}, i) => {\n      // Extract the data used to create the chapter UI\n      const {\n        duration,\n        imageUrl,\n        imageTitle,\n        mediaType,\n        title,\n        urn,\n        vendor\n      } = JSON.parse(text);\n      const chapterId = `${'chapter-' + i}`;\n      const chapter = document.createElement('a');\n\n      chapter.dataset.urn = urn;\n      chapter.className = 'chapter';\n      chapter.setAttribute('aria-labelledby', chapterId);\n      // Create the Play URL for the chapter\n      chapter.href = `https://www.${vendor.toLowerCase()}.ch/play/tv/-/${mediaType.toLowerCase()}/-?urn=${urn}`;\n      // The UI to display the chapter\n      chapter.innerHTML = /*html*/`\n        <figure>\n          <img\n            src=\"${imageUrl}\"\n            alt=\"${imageTitle}\"\n            loading=\"lazy\"\n          />\n          <figcaption id=\"${chapterId}\">\n            <p class=\"title\">${title}</p>\n            <span aria-hidden=\"true\" class=\"duration\">${pillarbox.time.formatTime(duration/1_000, 600)}</span>\n          </figcaption>\n        </figure>\n      `;\n\n      // Handle the click on a chapter\n      chapter.addEventListener('click', (e) => {\n        e.preventDefault();\n\n        // Add a small tolerance to avoid selecting the previous chapter when\n        // endTime matches the selected chapterâ€™s startTime\n        player.currentTime(startTime + 0.1);\n      });\n\n      // Append the chapter to the chapter selector element\n      chapterSelector.append(chapter);\n    });\n\n    // Append the chapter selector element to the document body\n    document.body.append(chapterSelector);\n  });\n\n  // Set the video source for the player\n  player.src({ src: 'urn:rts:video:10894383', type: 'srgssr/urn' });\n","\n  import pillarbox from '@srgssr/pillarbox-web';\n  import '../../src/layout/header/core-demo-header-component.js';\n\n  document.querySelector('#close-btn').addEventListener('click', () => {\n    window.close();\n  });\n\n  window.pillarbox = pillarbox;\n"],"names":["pillarbox","data","currentChapter","chapter","isChapterSelected","chapters","chapterSelector","startTime","text","i","duration","imageUrl","imageTitle","mediaType","title","urn","vendor","chapterId","e"],"mappings":"6DAKE,OAAO,OAASA,EACd,mBACA,CAAE,MAAO,EAAI,CACjB,EAGE,OAAO,GAAG,iBAAkB,CAAC,CAAE,KAAAC,EAAO,CAAE,KAAO,IAAI,KAAQ,CACzD,MAAMC,EAAiB,KAAK,MAAMD,EAAK,IAAI,EAG3C,SAAS,iBAAiB,UAAU,EAAE,QAAQE,GAAW,CACvD,MAAMC,EAAoBF,GAAkBA,EAAe,MAAQC,EAAQ,QAAQ,IACnFA,EAAQ,UAAU,OAAO,mBAAoBC,CAAiB,CAChE,CAAC,CACH,CAAC,EAGD,OAAO,GAAG,aAAc,IAAM,CAEzB,SAAS,eAAe,kBAAkB,GAC3C,SAAS,eAAe,kBAAkB,EAAE,OAAM,EAIpD,MAAMC,EAAW,MAAM,KAAK,OAAO,WAAU,EAAG,aAAa,iBAAiB,EAAE,IAAI,EAEpF,GAAG,CAACA,EAAU,OAGd,MAAMC,EAAkB,SAAS,cAAc,KAAK,EAEpDA,EAAgB,GAAI,mBAGpBD,EAAS,QAAQ,CAAC,CAAC,UAAAE,EAAW,KAAAC,CAAI,EAAGC,IAAM,CAEzC,KAAM,CACJ,SAAAC,EACA,SAAAC,EACA,WAAAC,EACA,UAAAC,EACA,MAAAC,EACA,IAAAC,EACA,OAAAC,CACR,EAAU,KAAK,MAAMR,CAAI,EACbS,EAAY,GAAG,WAAaR,CAAC,GAC7BN,EAAU,SAAS,cAAc,GAAG,EAE1CA,EAAQ,QAAQ,IAAMY,EACtBZ,EAAQ,UAAY,UACpBA,EAAQ,aAAa,kBAAmBc,CAAS,EAEjDd,EAAQ,KAAO,eAAea,EAAO,YAAW,CAAE,iBAAiBH,EAAU,YAAW,CAAE,UAAUE,CAAG,GAEvGZ,EAAQ,UAAoB;AAAA;AAAA;AAAA,mBAGfQ,CAAQ;AAAA,mBACRC,CAAU;AAAA;AAAA;AAAA,4BAGDK,CAAS;AAAA,+BACNH,CAAK;AAAA,wDACoBd,EAAU,KAAK,WAAWU,EAAS,IAAO,GAAG,CAAC;AAAA;AAAA;AAAA,QAMhGP,EAAQ,iBAAiB,QAAUe,GAAM,CACvCA,EAAE,eAAc,EAIhB,OAAO,YAAYX,EAAY,EAAG,CACpC,CAAC,EAGDD,EAAgB,OAAOH,CAAO,CAChC,CAAC,EAGD,SAAS,KAAK,OAAOG,CAAe,CACtC,CAAC,EAGD,OAAO,IAAI,CAAE,IAAK,yBAA0B,KAAM,aAAc,ECvFhE,SAAS,cAAc,YAAY,EAAE,iBAAiB,QAAS,IAAM,CACnE,OAAO,MAAK,CACd,CAAC,EAED,OAAO,UAAYN"}